{% extends 'layouts/base.html' %}

{% block title %}WordGuessr - {{ date }}{% endblock %}

{% block content %}
<h1 class="text-center text-2xl p-4">Puzzle {{ date }}</h1>
<input id="invisibleInput" class="opacity-0" onload="openKeyboard()">
<div id="puzzleState" hx-trigger="load" hx-get="/htmx/puzzles/{{ date }}" onclick="openKeyboard()">Puzzle data is here</div>
<a class="bg-cyan-500 rounded-md" href="/puzzles">Play Other Puzzles</a>
<!-- Hidden input field to trigger mobile keyboard -->
<input type="text" id="keyboardInput" style="opacity:0; position:absolute; top:-100px;" autocomplete="off">

<script>
    let guess = ""

    // The current row is dynamically given the class name "guess"
    var letterElements = document.getElementsByClassName("guess");

    const openKeyboard = () => {
        const invisibleInput = document.getElementById("invisibleInput");
        invisibleInput.focus();
    }

    const sendGuess = () => {
        htmx.ajax(
            'GET',
            `/htmx/puzzles/{{ date }}?guess=${guess}`,
            { target: '#puzzleState' }
        )
        guess = ""
    };

    document.addEventListener('keydown', event => {
        if (event.key == "Enter") {
            if (guess.length < letterElements.length) {
                console.log("Guess too short!")
            }
            else {
                sendGuess();
            }
            return
        }

        if (event.key == "Backspace") {
            guess = guess.slice(0, -1);
        }
        else if (guess.length >= letterElements.length) {
            return
        }
        else {
            guess += event.key.toUpperCase()
        }
        updateGuess();
    });

    const updateGuess = () => {
        for (let i = 0; i < letterElements.length; i++) {
            letterElements[i].innerHTML = guess.charAt(i)
        }
    }
</script>

{% endblock %}
